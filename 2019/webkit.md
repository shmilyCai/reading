# webkit技术内幕

## 1. 浏览器和浏览器内核

HTML5包含了一系列的标准，共包含10个大的类别：
1. 离线（offline）
2. 存储（storage）
3. 连接（connectivity）
4. 文件访问（file access）
5. 语义（semantics）
6. 音频和视频（audio/video）
7. 3D和图形（3D/graphics）
8. 展示（presentation）
9. 性能（performance）
10. 其他（Nuts and bolts）

HTTP是一种构建在TCP/IP之上的应用层协议，用于传输HTML文本和所涉及的各种资源，包括图片和多媒体等。

HTTPS是HTTP的安全版本，加入了SSL/TLS，用于安全地传输数据

渲染就是根据描述或者定义构建数学模型，通过模型生成图像的过程。

浏览器的渲染引擎就是能够将HTML/CSS/Javascript文本及其相应的资源文件转换成图像结果的模块。

渲染引擎主要包括：
1. HTML解释器，解释HTML文本的解释器，主要作用是将HTML文本解释成DOM（文档对象模型）树，DOM是一种文档的表示方法。
2. CSS解释器，级联样式表的解释器，作用是为DOM中的各个元素对象计算出样式信息，从而计算最后网页的布局提供基础设施。
3. 布局，在DOM创建之后，Webkit需要将其中的元素对象同样式信息结合起来，计算它们的大小位置等布局信息，形成一个能够表示这所有信息的内部表示模型，
4. Javascript引擎，使用Javascript代码可以修改网页的内容，也能修改css的信息，JavaScript引擎能够解释JavaScript代码并通过DOM接口和CSSOM接口来修改网页内容和样式信息，从而改变渲染的结果
5. 绘图，使用图形库将布局计算后的各个网页的节点绘制成图像结果。

## 2. HTML网页和结构

着重剖析HTML网页的构成和结构，通过对它们的解释来帮助理解webkit的渲染过程。

###  基本元素和树状结构

HTML 网页就是一种使用HTML语言撰写的文档。

JavaScript代码用来控制网页内部的逻辑。
Javascript是一种解释型的脚本语言，主要目的是控制用户端逻辑，同用户交互等，它可以修改HTML元素及其内容。

CSS用来描述网页的显示信息。

一个完整的网页组成包括HTML文本，JavaScript代码，CSS代码以及各种各样的资源文件。

### HTML5新特性

HTML5最新能力之一：对2D和3D图形以及多媒体的支持

主要包括：
1. HTML5视频，引入video元素，支持在网页中播放视频
2. Canvas 2D，定义canvas元素，利用该元素的2D绘图上下文调用标准定义的接口，绘制常见的2D图形，如点，线，矩形，多变形
3. WebGL（Canvas 3D），使用canvas元素，利用该元素的3D绘图上下文调用标准定义的接口，绘制3D图形
4. CSS3 3D变换（transform）和转换（transition），作用于HTML的任意可视元素，制造出各种炫丽的3D效果

### webkit的网页渲染过程

浏览器的主要作用就是将用户输入的URL转变成可视化的图像。

包含过程：
1. 网页加载过程，就是从URL到构建DOM树
2. 网页渲染过程，从DOM树到生成可视化图像

渲染过程中的数据和模块：
1. 数据包括网页内容，DOM，内部表示和图像，
2. 模块则包括HTML解释器，css解释器，JavaScript引擎以及布局和绘图模块

根据数据的流行，渲染过程的三个阶段：
1. 第一个阶段是从网页的URL到构建完DOM树，
2. 第二个阶段是从DOM树到构建完webkit的绘图上下文
3. 第三个阶段是从绘图上下文到生成最终的图像

从网页到DOM树过程：
1. 当用户输入网页URL的时候，webkit调用其资源加载器加载该URL对应的网页
2. 加载器依赖网络模块建立连接，发送请求并接收答复
3. webkit接收到各种网页或者资源的数据，其中某些资源可能是同步或者异步获取的
4. 网页被交给HTML解释器转变车成一系列的词语（TOKEN）
5. 解释器根据词语构建节点（Node），形成DOM树
6. 如果节点是JavaScript代码的话，调用JavaScript引擎解释并执行
7. JavaScript代码可能会修改DOM树的结构
8. 如果节点需要依赖其他资源，例如图片，css，视频等，调用资源加载器来加载它们，但是它们是异步的，不会阻碍当前DOM树的继续创建；如果是JavaScript资源URL（没有标记异步方式），则需要停止当前DOM树的创建，直到JavaScript的资源加载并被JavaScript引擎执行后才继续DOM树的创建

webkit利用CSS和DOM树创建RenderObject树直到绘图上下文，过程：
1. CSS文件被CSS解释器解释成内部表示结构
2. CSS解释器工作完之后，在DOM树上附加解释器后的样式信息，这就是RenderObject树
3. RenderObject节点在创建的同时，webkit会根据网页的层次结构创建RenderLayer树，同时构建一个虚拟的绘图上下文。

绘图上下文生成最终的图像，过程：
1. 绘图上下文是一个与平台无关的抽象类，它将每个绘图操作桥接到不同的具体实现类，也就是绘图具体实现类
2. 绘图实现类也可能有简单的实现，也可能有复杂的实现
3. 绘图实现类将2D图形库或者3D图形库绘制的结果保存下来，交给浏览器来同浏览器界面一起显示。



## 3. Webkit架构和模块

描述webkit为支持渲染而包含的基本模块和架构，同时结合chromium的架构和实现，来理解webkit的组成和浏览器的组成。















## 4. 资源加载和网络栈

介绍webkit的网络和资源加载机制，以及资源缓存策略。同时，在分析chromium多进程资源加载和全新网络栈和协议基础上，介绍一些HTML网页高效的资源使用方法。













## 5. HTML解释器和DOM模型

主要介绍DOM模型等方面的技术，并且描述Webkit中HTML解释器和DOM内部表示。









## 6. CSS解释器和样式布局

详解css解释器，并描述CSS3的新功能和webkit的支持情况。之后，分析webkit如何利用css来计算布局的过程。








## 7. 渲染基础

介绍目前的渲染方式以及根据网页结构来设计支持渲染的各种内部数据表示，包括RenderObject树和RenderLayer树，最后详细展现软件渲染网页的过程










## 8. 硬件加速机制

描述GPU硬件在目前渲染中所起的作用。现代浏览器越来越依赖GPU硬件加速渲染基础，特别是HTML5引入的众多标准。









## 9. Javascript引擎

专注于现代JavaScript引擎的介绍，包括JavaScript和V8引擎，描述它们在网页渲染中的作用









## 10. 插件和JavaScript扩展

介绍浏览器中的插件机制和扩展机制，包括webkit的NPAPI插件机制，chromium浏览器中的扩展机制，PPAPI机制和NativeClient技术，通过这些技术可以增加JavaScriptAPI在扩展JavaScript语言中的能力











## 11. 多媒体

专注于Webkit对多媒体方面的支持，包括音频和视频。
详解webkit的内部原理和对最新的html5视频及音频的支持。












## 12. 安全机制

描述HTML指定的网页安全规范并解释webkit和chromium浏览器的应对之策。













## 13. 移动WebKit

描述webkit支持移动领域特定的功能，同时也包括新的渲染机制。












## 14. 调试机制

详解webkit中的调试模块webInspector，包括结构和原理等。












## 15. Web前端的未来

谈对web未来发展的看法和目前一些明显的趋势。




















