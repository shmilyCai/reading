# 图解HTTP


## 总结

	未记录

  * [http报文内的http信息]
  * [确认访问用户身份的认证]
  * [基于http的功能追加协议]
  * [构建web内容的技术]

---

## 了解web及网络基础

web使用http的协议作为规范，完成从客户端到服务器端等一系列运作流程

客户端：通过发送请求获取服务区资源的web浏览器等，都称为客户端

### TCP/IP

tcp/ip是互联网相关的各类协议族的总称

分层管理：

1. 应用层

	应用层提供了用户提供应用服务时通信的活动

	tcp/ip协议族内预存了各类通用的应用服务，如ftp（文件传输协议），dns（域名系统），http（超文本传输协议）

2. 传输层

	传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输

	传输层有2个性质不同的协议：tcp（传输控制协议），udp（用户数据报协议）

3. 网络称

	网络层用来处理在网络上流动的数据包

	数据包是网络传输的最小数据单位

4. 数据链路层（网络接口层）

	用来处理连接网络的硬件部分

### tcp/ip通信传输流

### 与http关系密切的协议：ip，tcp，dns

1. ip

	ip网际协议位于网络层，“IP”其实是一种协议的名称

	ip协议的作用是把各种数据包传送给对方，要保证正确传送需要IP地址和mac地址

	ip地址指明了节点被分配到的地址，mac地址是指网卡所属的固定地址，IP地址与mac地址进行配对，IP地址可变换，但mac地址基本上不会变更

2. tcp

	tcp位于传输层，提供可靠的字节流服务；字节流服务指为了方便传输，将大块数据分割成报文段为单位的数据包进行管理，而可靠的传输服务是指，能够把数据准确可靠的传给对方

	tcp协议采用了三次握手策略，握手过程中使用tcp的标志

3. dns

	dns服务是和http协议一样位于应用层的协议，提供域名到IP地址之间的解析服务

	dbs协议提供通过域名查找IP地址，或者逆向从IP地址反查域名的服务


### URI和URL

1. URI为统一资源标识符

	URI（uniform Resource Identifier），就是由某个协议方案表示的资源的定位标识符，协议方案是指访问资源所使用的协议类型名称

	uniform，规定统一的格式可方便处理多种不同的类型的资源

	Resource，资源的定义是“可标识的任何东西”

	Identifier，表示可标识的对象，也称为标识符

	表示指定的URI，要使用涵盖全部必要信息的绝对URI，绝对URL以及相对URL


2. URL为统一资源定位符

	URL正是使用web浏览器等访问web页面时需要输入的网页地址

	URL是URI的子集


---

## 简单的HTTP协议

### http协议用于客户端和服务器端之间的通信

	客户端：请求访问文本或者图像等资源的一端称为客户端，请求必定为客户端发出

	服务器端：提供资源响应的一端称为服务器端，服务器端回复响应

### 通过请求和响应的交换达成通信

	http协议规定，请求从客户端发出，最后服务器端响应该请求并返回


![01](img/01.png)

```
//以下为客户端发送给服务端的请求报文中的内容
“GET /index.htm HTTP/1.1
	Host: hackr.jp”
```

`GET`表示请求访问服务器的类型，称为方法

`/index.htm`指明请求访问的资源对象，也叫做请求URI

`HTTP/1.1`即HTTP的版本号，用来提示客户端使用的http协议功能

综合以上，这段请求的内容的意思是：请求访问某台http服务器上的`/index.html`页面资源


```
“HTTP/1.1 200 OK
Date: Tue, 10 Jul 2012 06:50:15 GMT  //创建响应的日期时间
Content-Length: 362
Content-Type: text/html  //以下的为响应主体
<html>”
```
`HTTP/1.1`表示服务器对应的http版本

`200 ok`表示请求的处理结果的状态码和原因短语


### http是不保存状态的协议

	http协议自身不对请求和响应之间的通信状态进行保存，这是为了更快的处理大量的事务，确保协议的可伸缩性

### 请求URI定位资源

http协议使用URI定位互联网上的资源

### 告知服务器意图的http方法

GET，获取资源

POST，传输实体的主体

PUT，传输文件

HEAD，获得报文首部

DELETE，删除文件，删除指定的资源

OPTIONS，用来查询针对请求URI指定的资源支持的方法

TRACE，让web服务器端将之前的请求通信环回给客户端的方法

CONNECT，要求在与代理服务器通信时建立隧道，实现用隧道协议进行tcp通信

### 使用cookie的状态管理

cookie技术通过在请求和响应报文中写入cookie信息来控制客户端的状态



---


## 返回结果的HTTP状态码

HTTP状态码负责表示客户端HTTP请求的返回结果，标记服务器端的处理是否正常，通知出现的错误等工作。


## 状态码类别

1XX，接收的请求正在处理

2XX，请求正常处理完毕

	200，表示客户端发送到请求被正常处理了

3XX，需要进行附加操作以完成请求（重定向）

	301，永久性重定向，该状态码表示请求的资源已被分配了新的URI，以后应使用资源现在所指的URI
	302，临时性重定向，该状态码表示请求的资源已被分配了新的URI，希望用户能使用新的URI访问
	303，该状态码表示由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源

4XX，服务器无法处理请求，表明客户端是发生错误的原因所在
	
	400，该状态码表示报文中存在语法错误，当错误发生时，需修改请求的内容后再次发送请求
	401，该状态码表示发送的请求需要有通过HTTP认证的认证信息
	403，该状态码表明对请求资源的访问被服务器拒绝了

5XX，服务器处理请求出错，表明服务器本身发生错误

	500，该状态码表明服务器端在执行请求时发生了错误

---

## 与HTTP协作的web服务器

一台web服务器可搭建多个独立域名的web网站，也可作为通信路径上的中转服务器提升传输效率

物理层面只有一台服务器，但只要使用虚拟机主机的功能，则可以假象已具有多台服务器

### 虚拟服务器

### 代理

代理是一种有转发功能的应用程序，它扮演了位于服务器和客户端中间人的角色，接收由客户端发送的请求并转发给服务器，同时也接受服务器返回的响应并转发给客户端

代理服务器的基本行为就是接收客户端发送的请求后转发给其它服务器，

代理不改变请求URI，会直接发送给前方持有资源的目标服务器

常用分类

1. 是否使用缓存

2. 是否会修改报文

### 网关

网关是转发其它服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。

利用网关可以由HTTP请求转化为其它协议通信


### 隧道

隧道是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序


### 缓存

缓存是指代理服务器或客户端本地磁盘内保存的资源副本，利用缓存可减少对源服务器的访问，

缓存服务器是代理服务器的一种，并归类在缓存代理类型中

### FTP

传输文件时使用的协议



---

## HTTP首部

http协议的请求和响应报文中必定包含http首部，

---


## 确保web安全的HTTPS

HTTP缺点：

1. 通信使用明文，内容可能会被窃听

2. 不验证通信方的身份，因此有可能遭遇伪装

3. 无法证明报文的完整性，所以有可能已早篡改


HTTP + 加密 + 认证 + 完整性保护 = HTTPS

HTTPS并非是应用层的一种新协议，只是HTTP通信接口部分用SSL和TSL协议代替而已。


---

## web的攻击技术

对web应用的攻击模式有以下2种：

1. 主动攻击

	在HTTP请求报文内加载攻击代码，就能发起对web应用的攻击，通过URL查询字段或者表单，http首部，cookie等途径把攻击代码传入，
	若这时web应用存在安全漏洞，那内部信息就会遭到窃取，或者被攻击者拿到管理权限。

	SQL注入攻击

	OS命令注入攻击

2. 被动攻击

	是指利用圈套策略执行攻击代码的攻击模式。

	代表性攻击是：跨站脚本攻击和跨站点请求伪造

	被动攻击模式步骤：

	1. 攻击者诱使用户触发已设置好的陷进，而陷进会启动发送已嵌入攻击代码的HTTP请求

	2. 当用户不知不觉中招之后，用户的浏览器或者邮件客户端就会触发这个陷阱

	3. 中招后的用户浏览器会把含有攻击代码的HTTP请求发送给作为攻击目标的web应用，运行攻击代码

	4. 执行完攻击代码，存在安全漏洞的web应用会成为攻击者的跳板，可能导致用户所持有的cookie等个人信息被窃取，登录状态中的用户权限遭恶意滥用等后果。


---































































