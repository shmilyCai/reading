# JavaScript高级程序设计

## 总结

基础书籍，网上据称为“小红书”，可细读


## 变量，作用域和内存

### 基本类型值和引用类型值

基本类型：Undefined，Null，Boolean，Number和String
引用类型：object，函数，数组，

### 特点

	1. 基本类型值在内存中占据固定大小的空间，因此被保存在栈内存中
	2. 从一个变量向另一个变量复制基本类型的值，会创建这个值的一个副本
	3. 引用类型的值是对象，保存在堆内存中
	4. 包含引用类型值的变量实际上包含的并不是对象本身，而是一个指向该对象的指针
	5. 从一个变量向另一个变量复制引用类型的值，复制的其实是指针，因此两个变量最终都指向同一个对象
	6. 确定一个值是哪种基本类型可以使用typeof操作符，而确定一个值是哪种引用类型可以使用instanceof操作符

所有变量（包括基本类型和引用类型）都存在于一个执行环境（也称为作用域）当中，这个执行环境决定了变量的生命周期，以及哪一部分代码可以访问其中的变量。

### 执行环境

	1. 执行环境有全局执行环境（也称为全局环境）和函数执行环境之分
	2. 每次进入一个新的执行环境，都会创建一个用于搜索变量和函数的作用域链
	3. 函数的局部环境不仅有权访问函数作用域中的变量，而且有权访问其包含（父）环境，乃至全局环境
	4. 全局环境只能访问在全局环境中定义的变量和函数，而不能直接访问局部环境中的任何数据
	5. 变量的执行环境有助于确定应该何时释放内存

### 垃圾收集

	1. 离开作用域的值将被自动标记为可以回收，因此将在垃圾收集期间被删除
	2. “标记清除”是目前主流的垃圾收集算法，这种算法的思想是给当前不使用的值加上标记，然后再回收其内存
	3. 另一种垃圾收集算法是“引用计数”，这种算法的思想是跟踪记录所有值被引用的次数，
	4. 当代码中存在循环引用现象时，“引用计数”算法就会导致问题
	5. 解除变量的引用不仅有助于消除循环引用现象，而且对垃圾收集也有好处，为了确保有效的回收内存，应该及时解除不再使用的全局对象，全局对象属性以及循环引用变量的引用

### 引用类型

	1. 引用类型与传统面向对象程序设计中的类相似，但实现不同
	2. Oject是一个基础类型，其它所有类型都从Object继承了基本的行为
	3. Array类型是一组值的有序列表，同时还提供了操作和转换这些值的功能
	4. Date类型提供了有关日期和时间的信息，包括当前日期和时间以及相关的计算功能
	5. RegExp类型是ECMAScript支持正则表达式的一个接口，提供了最基本的和一些高级的正则表达式功能
	6. 函数实际上是Function类型的实例，因此函数也是对象。由于函数是对象，所以函数也拥有方法，可以用来增强其行为。因为有了基本包装类型，所以js中的基本类型值可以被当作对象来访问。三种基本包装类型分别为：Boolean，Number和String。特征：
		每个包装类型都映射到同名的基本类型
		在读取模式下访问基本类型值时，就会创建对应的基本包装类型的一个对象，从而方便了数据操作
		操作基本类型值的语句一经执行完毕，就会立即销毁新创建的包装对象

在所有代码执行之前，作用域中就已经存在两个内置对象：Global和Math；

web浏览器实现了可访问Global对象的是window对象

全局变量和函数都是Global对象的属性。Math对象提供了很多属性和方法，用于辅助完成复杂的数学计算任务


## 面向对象的程序设计与函数表达式

### 创建对象

	1. 工厂模式
	使用简单的函数创建对象，为对象添加属性和方法，然后返回对象

	2. 构造函数
	可以创建自定义引用类型，可以像创建内置对象实例一样使用new操作符。
	缺点：级它的每个成员都无法得到复用，包括函数，即不存在共享函数。

	3. 原型模式
	使用构造函数的prototype属性来指定那些应该共享的属性和方法。组合使用构造函数模式和原型模式时，使用构造函数定义实例属性，而使用原型定义共享的属性和方法

### 继承

	1. 原型链继承
	js通过原型链实现继承。
	原型链的构建是通过将一个类型的实例赋值给另一个构造函数的原型实现的。
	这样，子类型就能够访问超类型的所有属性和方法。
	原型链的问题是对象实例共享所有继承的属性和方法，因此不适宜单独使用。
	借用构造函数，即在子类型构造函数的内部调用超类型构造函数。这样就可以做到每个实例都具有自己的属性，同时还能保证只使用构造函数模式来定义类型。使用最多的继承模式是组合继承，这种模式使用原型链继承共享的属性和方法，而通过借用构造函数继承实例属性

	2. 原型式继承
	可以在不必须预先定义构造函数的情况下实现继承，其本质是执行对给定对象的浅复制。而复制得到的副本还可以得到进一步改造

	3. 寄生式继承
	与原型式继承相似，也是基于某个对象或者某些信息创建一个对象，然后增强对象，最后返回对象。
	为了解决组合继承模式由于多次调用超类型构造函数而导致的低效率问题，可以将这个模式与组合继承一起使用

	4. 寄生组合式继承
	集寄生式继承和组合继承的有点与一身，是实现基于类型继承的最有效方式



### 函数声明

重要特征：在执行代码之前会先读取函数声明，意味着可以把函数声明放在调用它的语句后面

```
//函数声明
function name(){}
```

### 函数声明与函数表达式

看起来好像是常规的变量赋值语句，即创建一个函数并将它赋值给变量functionName，创建的函数称为匿名函数。

函数表达式在使用前必须先赋值。

```

//函数表达式
var name = function(){}

```

特点：

	1. 函数表达式不同于函数声明，函数声明要求有名字，但是函数表达式不需要，没有名字的函数表达式也叫做匿名函数
	2. 在无法确定如何引用函数的情况下，递归函数就会变得比较复杂
	3. 递归函数应该始终使用argument.callee来递归的调用自身，不要使用函数名，函数名可能会发生变化

### 闭包

当在函数内部定义了其它函数时，就创建了闭包。

闭包有权访问包含函数内部的所有变量

原理：

	1. 在后台执行环境中，闭包的作用域链包含着它自己的作用域，包含函数的作用域和全局作用域
	2. 通常，函数的作用域及其所有变量都会在函数执行结束后被销毁
	3. 但是，当函数返回了一个闭包时，这个函数的作用域将会一直在内存中保存到闭包不存在为止

使用闭包可以在js中模仿块级作用域，要点：

	1. 创建并立即调用一个函数，这样既可以执行其中的代码，又不会在内存中留下对该函数的引用
	2. 结果就是函数内部的所有变量都会被立即销毁，除非某些变量赋值给了包含作用域（即外部作用域）中的变量

使用闭包可用于在对象中创建私有变量，要点：

	1. js中没有正式的私有对象属性的概念，但可以使用闭包来实现公有方法，而通过公有方法可以访问在包含作用域中定义的变量
	2. 有权访问私有变量的公有方法叫特权方法
	3. 可以使用构造函数模式，原型模式来实现自定义类型的特权方法，也可以使用模块模式，增强的模块模式来实现单例的特权方法



---

## 浏览器对象模型（BOM）和文档对象模型（DOM）

### 浏览器对象模型
浏览器对象模型（BOM）以window对象为依托，表示浏览器窗口以及页面可见区域。

widwos对象也是ECMAScript中的Global对象，因而所有全局变量和函数都是它的属性，而且所有原生的构造函数及其它函数也都存在于它的命名空间下。

1. 在使用框架时，每个框架都有自己的window对象以及所有原生构造函数及其它函数的副本。每个框架都保存在frame集合中，可以通过位置或者通过名称来访问

2. 有一些窗口指针，可以用来引用其它框架，包括父框架

3. top对象始终指向最外围的框架，也就是整个浏览器窗口

4. parent对象表示包含当前框架的框架，而self对象则回指window

5. 使用location对象可以通过编程方式来访问浏览器的导航系统。设置相应的属性，可以逐段或整体性地修改浏览器的URL

6. 调用replace()方法可以导航到一个新URL，同时该URL会替换浏览器历史记录中当前显示的页面

7. navigator对象提供了与浏览器相关的信息。

screen，该对象中保存着与客户端显示器有关的信息，一般只用于站点分析

history，该对象为访问浏览器的历史记录

### 客户端检测

1. 能力检测

	在编写代码之前先检测特定浏览器的能力。

2. 怪癖检测

	怪癖实际上是浏览器实现中存在的bug

3. 用户代理检测

	通过检测用户代理字符串来识别浏览器

### 文档对象模型（DOM）

DOM是针对HTML和XML文档的一个API。

DOM描绘了一个层次化的节点树，允许开发人员添加，移除和修改页面的某一部分

DOM用于访问和操作HTML和XML文档。

各种节点构成，简要总结如下：

	1. 最基本的节点类型是Node，用于抽象地表示文档中一个独立的部分，所有其它类型都继承自Node
	2. Document类型表示整个文档，是一组分层节点的根节点。在js中，documen对象是Document的一个实例。使用document对象，有很多种方式可以查询和取得节点。
	3. Element节点表示文档中的所有HTML或者XML元素，可以用来操作这些元素的内容和特性
	4. 另外还有一些节点类型，分别表示文本内容，注释，文档类型，CDATA区域和文档片段


## Ajax

Ajax是无需刷新页面就能够从服务器取得数据的一种方法。

关于Ajax的总结：

	1. 负责Ajax运作的核心对象是XMLHttpRequest（XHR）对象
	2. XHR对象由微软最早在IE5中引入，用于通过js从服务器去的xml数据
	3. 虽然各个浏览器之间存在差异，但XHR对象的基本用法在不同浏览器间还是相对规范的

### 同源策略和跨域

同源策略是对XHR的一个主要约束。

同源策略指为通信设置了相应的域名，相同的端口和相同的协议

### 跨域解决方案

CORS（跨源资源共享）

JSONP（只支持GET请求）

### 客户端推送数据到服务端

SSE（Server-Sent Events，服务器发送事件），是一种实现Comet交互的浏览器API，支持长轮询和HTTP流

web Sockets，是一种与服务器进行全双工，双向通信的信息。采用自定义的协议。
























